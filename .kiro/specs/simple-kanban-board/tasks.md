# Implementation Plan

## タスク一覧

- [x] 1. プロジェクト基盤のセットアップ
  - Vite + React + TypeScript プロジェクトを初期化
  - 必要な依存関係をインストール（@dnd-kit, zustand, tailwindcss等）
  - TypeScript設定を構成（strictモード有効化）
  - Tailwind CSSを設定し、基本スタイルを準備
  - ESLintとPrettierを設定してコード品質を確保
  - _Requirements: すべての要件に共通する基盤セットアップ_

- [ ] 2. データモデルと型定義の実装
  - カードエンティティの型定義を作成
  - カラムIDの型定義とカラム定義の定数を作成
  - ボード状態の型定義を作成
  - UUID生成のユーティリティ関数を実装
  - _Requirements: 8.1, 8.2, 8.4（データ構造）_

- [ ] 3. LocalStorage永続化サービスの実装
- [ ] 3.1 ストレージサービスの基本実装
  - LocalStorage読み書きのインターフェースを定義
  - JSON シリアライズ/デシリアライズ機能を実装
  - エラー型定義とエラーハンドリングを実装
  - _Requirements: 7.2, 7.3（データ永続化）_

- [ ] 3.2 エラーハンドリングと復旧処理
  - QuotaExceededエラーの検出と通知機能を実装
  - JSONパースエラーからの自動復旧機能を実装
  - LocalStorage可用性チェック機能を実装
  - _Requirements: 7.4（ストレージエラー処理）_

- [ ] 4. Zustand状態管理ストアの実装
- [ ] 4.1 BoardStoreの基本構造
  - Zustand storeの初期化とpersistミドルウェアの設定
  - カード配列の状態定義
  - カラムごとのカードフィルタリングselectorを実装
  - _Requirements: 7.1, 7.5（状態管理とデータ保存）_

- [ ] 4.2 カード操作アクションの実装
  - addCard アクションを実装（カード作成とorder割り当て）
  - updateCard アクションを実装（タイトル更新とtimestamp更新）
  - deleteCard アクションを実装（削除後のorder再計算）
  - moveCard アクションを実装（カラム間移動とorder更新）
  - _Requirements: 2.3, 2.4, 2.5（カード作成）、5.3（カード編集）、6.2（カード削除）、4.3, 4.4（カード移動）_

- [ ] 5. 基本UIコンポーネントの実装
- [ ] 5.1 カードコンポーネント
  - カード表示コンポーネントを作成（タイトル、ボーダー、スタイル）
  - ダブルクリックで編集モードに切り替える機能を実装
  - 編集モード時のインライン入力フォームを実装
  - 空タイトルのバリデーションを実装
  - 削除ボタンUIを実装
  - _Requirements: 3.1, 3.2（カード表示）、5.1, 5.2, 5.3, 5.4（カード編集）、6.1（削除ボタン）_

- [ ] 5.2 カラムコンポーネント
  - カラム表示コンポーネントを作成（タイトルヘッダー、カードリスト）
  - カラムIDに基づいてカードをフィルタリングして表示
  - カラムごとの視覚的な区切りスタイルを適用
  - _Requirements: 1.2（カラム名表示）、1.3, 1.4（カード表示）、9.2（視覚的区切り）_

- [ ] 5.3 カード追加フォームコンポーネント
  - カラム下部に配置する追加ボタンUIを作成
  - クリック時にタイトル入力フォームを表示
  - 空タイトルのバリデーションと拒否処理を実装
  - 有効な入力時にBoardStoreのaddCardを呼び出し
  - _Requirements: 2.1, 2.2, 2.6（カード作成UI）_

- [ ] 6. ドラッグ&ドロップ機能の実装
- [ ] 6.1 @dnd-kit基本設定
  - DndContextをボードコンポーネントに統合
  - センサー設定（マウス、タッチ、キーボード）を構成
  - 衝突検出アルゴリズムを設定
  - _Requirements: 4.1（ドラッグ可能状態）_

- [ ] 6.2 カードのドラッグ可能化
  - useSortable フックをカードコンポーネントに統合
  - ドラッグ中の視覚的フィードバック（透明度、影）を実装
  - ドラッグハンドル領域を設定
  - _Requirements: 4.2（視覚的フィードバック）_

- [ ] 6.3 カラム間ドロップ処理
  - onDragEnd ハンドラーを実装
  - 移動先カラムと新しいorder値を計算
  - BoardStoreのmoveCardアクションを呼び出し
  - 他のカードの位置自動調整ロジックを実装
  - Escキーでのドラッグキャンセル処理を実装
  - _Requirements: 4.3, 4.4, 4.5, 4.6（ドラッグ&ドロップ動作）_

- [ ] 7. ボードコンポーネントの統合
  - ボード全体のレイアウトコンポーネントを作成
  - 3つのカラムを水平方向に配置
  - DndContextで全体をラップ
  - レスポンシブデザインを実装（モバイル、タブレット、デスクトップ）
  - _Requirements: 1.1（3カラム表示）、9.1（水平配置）、9.5（レスポンシブ）_

- [ ] 8. アプリケーション初期化とデータ読み込み
  - アプリケーション起動時のLocalStorage読み込み処理を実装
  - データ存在チェックと空ボード初期化を実装
  - スキーマバージョンチェックとマイグレーション準備を実装
  - エラー時のフォールバック処理（データクリア、通知）を実装
  - _Requirements: 1.5（データ読み込み）、7.2, 7.3（起動時のデータ復元）_

- [ ] 9. エラーハンドリングとユーザーフィードバック
  - トースト通知コンポーネントを実装
  - バリデーションエラーメッセージ表示を実装
  - ストレージエラー（quota、parse失敗）の通知を実装
  - LocalStorage利用不可時の警告バナーを実装
  - ホバー時の視覚的フィードバックを実装
  - _Requirements: 9.3（視覚的フィードバック）、9.4（エラーメッセージ）_

- [ ] 10. アクセシビリティ機能の実装
- [ ] 10.1 キーボードナビゲーション
  - Tab キーでのフォーカス移動順序を設定
  - フォーカスインジケータのスタイルを実装
  - Enter/Space キーでのボタン実行を実装
  - _Requirements: 10.1, 10.3, 10.4（キーボード操作）_

- [ ] 10.2 スクリーンリーダー対応
  - ARIA ラベルとロールを各コンポーネントに追加
  - ドラッグ&ドロップのスクリーンリーダー指示を設定
  - カード数や状態変化のライブリージョンを実装
  - _Requirements: 10.2（スクリーンリーダー）_

- [ ] 11. テストの実装
- [ ] 11.1 ユニットテスト
  - BoardStoreアクション（addCard, updateCard, deleteCard, moveCard）のテストを作成
  - StorageService（saveState, loadState）のテストを作成
  - ユーティリティ関数（generateCardId, recalculateOrder）のテストを作成
  - _Requirements: すべての要件の正確性を検証_

- [ ] 11.2 統合テスト
  - カード作成フロー（UI → Store → LocalStorage）のテストを作成
  - カード移動フロー（ドラッグ&ドロップ → Store更新）のテストを作成
  - データ永続化と復元フローのテストを作成
  - _Requirements: 2（カード作成）、4（ドラッグ&ドロップ）、7（永続化）_

- [ ] 11.3 E2Eテスト
  - 基本的なカンバンワークフロー（作成、移動、削除、リロード）のテストを作成
  - カード編集フローのテストを作成
  - レスポンシブ動作のテストを作成
  - アクセシビリティ（キーボード操作、スクリーンリーダー）のテストを作成
  - _Requirements: すべての要件のエンドツーエンド検証_

- [ ] 12. パフォーマンス最適化
  - React.memo でカードコンポーネントをメモ化
  - useMemo でカラムごとのカードリストをキャッシュ
  - useCallback でイベントハンドラをメモ化
  - 大量カード（1000件）での動作確認と最適化
  - _Requirements: パフォーマンス要件（設計書で定義）_

- [ ] 13. 最終統合とポリッシュ
  - すべてのコンポーネントを統合し、エンドツーエンドで動作確認
  - UIの視覚的調整（間隔、色、フォント）を実施
  - エラーケースとエッジケースの動作確認
  - ブラウザ互換性テスト（Chrome, Firefox, Safari）を実施
  - _Requirements: すべての要件の統合検証_

## タスク進捗トラッキング

各タスクを完了したら、`- [ ]` を `- [x]` に変更してください。

## 実装の順序について

このタスクリストは、依存関係を考慮した順序で並んでいます：
1. 基盤（プロジェクトセットアップ、型定義）
2. データ層（ストレージ、状態管理）
3. UI層（コンポーネント）
4. インタラクション層（ドラッグ&ドロップ）
5. 統合とテスト
6. 最適化

各タスクは前のタスクの成果物を使用するため、順番に実装することを推奨します。
